{% extends "base.html" %}

{% block content %}

<section class="table-section">
    <div class="table-header">
        <h2>Implementation challenges and actions</h2>
        <p class="table-hint">
            Track key implementation bottlenecks, agreed actions, responsible leads and timelines.
        </p>
    </div>

    <div class="table-wrapper">
        <table class="compact-table">
            <thead>
            <tr>
                <th style="width: 30%;">Challenge</th>
                <th style="width: 30%;">Agreed action</th>
                <th style="width: 12%;">Responsible</th>
                <th style="width: 13%;">Timeline</th>
                <th style="width: 15%;">Status</th>
            </tr>
            </thead>
            <tbody>
            {% for c in challenges %}
                <tr>
                    <td>{{ c.challenge }}</td>
                    <td>{{ c.action }}</td>
                    <td>{{ c.responsible or "-" }}</td>
                    <td>{{ c.timeline or "-" }}</td>
                    <td>
                        <span class="status-badge status-{{ c.status or 'pending' }}">
                            {{ (c.status or 'pending').title() }}
                        </span>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="5" class="empty">
                        No challenges have been recorded yet.
                        {% if current_user.role == 'admin' %}
                            Use the form below to add the first one.
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% if current_user.role == 'admin' %}
        <form method="post"
              action="{{ url_for('activity.add_challenge') }}"
              class="upload-form"
              style="margin-top: 1rem;">
            <input type="hidden" name="next" value="{{ request.full_path }}">
            <div class="field-group">
                <label for="challenge">New challenge</label>
                <textarea id="challenge" name="challenge" rows="2"
                          placeholder="Describe the implementation challenge"></textarea>
            </div>
            <div class="field-group">
                <label for="action">Agreed action</label>
                <textarea id="action" name="action" rows="2"
                          placeholder="Describe what will be done to address it"></textarea>
            </div>
            <div class="field-group">
                <label for="responsible">Responsible</label>
                <input id="responsible" name="responsible" type="text" placeholder="Person / team">
            </div>
            <div class="field-group">
                <label for="timeline">Timeline</label>
                <input id="timeline" name="timeline" type="text" placeholder="e.g. Q1 2026, by 30 June">
            </div>
            <div class="field-group">
                <label for="status">Status</label>
                <select id="status" name="status" required>
                    <option value="pending" selected>Pending</option>
                    <option value="completed">Completed</option>
                    <option value="canceled">Canceled</option>
                </select>
            </div>
            <button type="submit">Add challenge</button>
        </form>
    {% endif %}
</section>

{% endblock %}


